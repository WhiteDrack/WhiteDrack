<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jump Pro - Final Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #00ff88; --bg: #0b0f19; --card: #161b22; --text: #f0f6fc; --nav-bg: #1f242d; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; }
        
        .page { display: none; flex-direction: column; align-items: center; width: 100%; padding: 20px; box-sizing: border-box; min-height: 100vh; }
        .active { display: flex; animation: fadeIn 0.3s ease; }

        .card { background: var(--card); padding: 25px; border-radius: 24px; border: 1px solid #30363d; width: 100%; max-width: 380px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* Auth Styles */
        input { width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        .btn-auth { width: 100%; padding: 14px; margin: 6px 0; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-google { background: #fff; color: #000; }
        .btn-fb { background: #1877f2; color: #fff; }
        .btn-phone { background: #34b7f1; color: #fff; }

        /* Navigation */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: var(--nav-bg); display: none; justify-content: space-around; align-items: center; border-top: 1px solid #30363d; z-index: 1000; }
        .nav-item { background: none; border: none; color: #8b949e; font-size: 11px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-item i { font-size: 20px; }
        .nav-item.active-nav { color: var(--primary); }

        /* Leaderboard */
        .player-row { display: flex; align-items: center; padding: 15px; background: #21262d; margin-bottom: 8px; border-radius: 15px; border: 1px solid #30363d; width: 100%; box-sizing: border-box; }
        .rank-num { width: 25px; font-weight: bold; color: var(--primary); }
        .p-name { flex-grow: 1; text-align: left; font-size: 14px; }
        .p-score { font-weight: 800; color: var(--primary); }

        /* Jump UI */
        #heightDisplay { font-size: 85px; font-weight: 900; color: var(--primary); margin: 10px 0; }
        #statusText { color: #e3b341; font-weight: bold; font-size: 13px; text-transform: uppercase; margin-bottom: 20px; }

        .uid-box { background: #0d1117; padding: 10px; border-radius: 10px; font-family: monospace; font-size: 10px; color: #666; margin-top: 15px; border: 1px dashed #333; word-break: break-all; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loginPage" class="page active">
        <div class="card" style="margin-top: 50px;">
            <i class="fas fa-rocket" style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"></i>
            <h2 style="margin: 0;">Jump Pro</h2>
            <p style="color: #8b949e; font-size: 13px; margin-bottom: 25px;">Level up your fitness</p>
            
            <input type="email" id="emailInput" placeholder="Email">
            <input type="password" id="passInput" placeholder="Password">
            <button class="btn-auth btn-primary" onclick="emailAuth()">Login / Sign Up</button>
            <span onclick="resetPass()" style="font-size: 12px; color: var(--primary); cursor: pointer; text-decoration: underline;">Forgot Password?</span>

            <div style="margin: 20px 0; color: #333; font-size: 12px; font-weight: bold;">SOCIAL LOGIN</div>
            
            <button class="btn-auth btn-google" onclick="googleAuth()"><i class="fab fa-google"></i> Google</button>
            <button class="btn-auth btn-fb" onclick="fbAuth()"><i class="fab fa-facebook"></i> Facebook</button>
            <button class="btn-auth btn-phone" onclick="navTo('phonePage')"><i class="fas fa-phone"></i> Phone Number</button>
        </div>
    </div>

    <div id="phonePage" class="page">
        <div class="card">
            <h3>Phone Login</h3>
            <input type="text" id="phoneNum" placeholder="+91 0000000000">
            <div id="recaptcha-container"></div>
            <button class="btn-auth btn-primary" onclick="sendOTP()">Send OTP</button>
            
            <div id="otpSection" style="display:none; margin-top:15px;">
                <input type="text" id="otpInput" placeholder="6-digit OTP">
                <button class="btn-auth btn-primary" onclick="verifyOTP()">Verify & Start</button>
            </div>
            <button class="btn-auth" onclick="navTo('loginPage')" style="background:none; color:#8b949e;">Back</button>
        </div>
    </div>

    <div id="jumpPage" class="page">
        <div class="card">
            <h3 style="margin:0; font-size: 12px; color:#555;">LAST JUMP</h3>
            <div id="heightDisplay">0.00</div>
            <div style="font-size: 12px; letter-spacing: 3px; color:#555; margin-bottom:20px;">METERS</div>
            <div id="statusText">SENSORS ON STANDBY</div>
            <button id="startBtn" class="btn-auth btn-primary" style="margin-top:10px;">ACTIVATE SENSORS</button>
        </div>
    </div>

    <div id="leaderboardPage" class="page">
        <h2 style="margin-bottom:20px;"><i class="fas fa-trophy" style="color:#ffd700;"></i> Top 10 World</h2>
        <div id="lbList" style="width:100%; max-width:380px;">
            </div>
    </div>

    <div id="profilePage" class="page">
        <div class="card">
            <img id="pImg" style="width:85px; height:85px; border-radius:50%; border:2px solid var(--primary); padding:3px;" src="https://via.placeholder.com/85">
            <h2 id="pName" style="margin: 15px 0 5px 0;">User</h2>
            <div id="pEmail" style="font-size: 12px; color: #8b949e;">email@example.com</div>
            <div class="uid-box">ID: <span id="pUid">---</span></div>
            
            <div style="margin-top: 25px; background: #0d1117; padding: 20px; border-radius: 18px;">
                <span style="font-size: 11px; color: #555;">PERSONAL BEST</span><br>
                <span id="pBest" style="font-size: 32px; font-weight: 900; color: var(--primary);">0.00m</span>
            </div>
            
            <button onclick="logout()" style="margin-top:30px; background:none; border:none; color:#f85149; font-weight:bold; cursor:pointer;"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </div>

    <nav id="bottomNav" class="nav-bar">
        <button class="nav-item active-nav" onclick="navTo('jumpPage', this)"><i class="fas fa-bolt"></i><span>JUMP</span></button>
        <button class="nav-item" onclick="navTo('leaderboardPage', this)"><i class="fas fa-chart-line"></i><span>RANKING</span></button>
        <button class="nav-item" onclick="navTo('profilePage', this)"><i class="fas fa-user-circle"></i><span>PROFILE</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, 
            signInWithEmailAndPassword, createUserWithEmailAndPassword, 
            sendPasswordResetEmail, RecaptchaVerifier, signInWithPhoneNumber, 
            onAuthStateChanged, signOut 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, set, query, orderByChild, limitToLast, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOPErXM1g4vdmiVdau67U7vGRsmbtMMhE",
            authDomain: "white-drack-fd1ee.firebaseapp.com",
            databaseURL: "https://white-drack-fd1ee-default-rtdb.firebaseio.com",
            projectId: "white-drack-fd1ee",
            storageBucket: "white-drack-fd1ee.firebasestorage.app",
            messagingSenderId: "151227903888",
            appId: "1:151227903888:web:02a2d7ab14f7d1e152cd15"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;
        let myBest = 0;

        // --- AUTH FUNCTIONS ---
        window.emailAuth = async () => {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) {
                if(e.code === 'auth/user-not-found') await createUserWithEmailAndPassword(auth, email, pass);
                else alert(e.message);
            }
        };

        window.resetPass = () => {
            const email = document.getElementById('emailInput').value;
            if(!email) return alert("Enter email first");
            sendPasswordResetEmail(auth, email).then(() => alert("Reset link sent!"));
        };

        window.googleAuth = () => signInWithPopup(auth, new GoogleAuthProvider());
        window.fbAuth = () => signInWithPopup(auth, new FacebookAuthProvider());

        window.sendOTP = () => {
            const phone = document.getElementById('phoneNum').value;
            const verifier = new RecaptchaVerifier(auth, 'recaptcha-container', {});
            signInWithPhoneNumber(auth, phone, verifier).then(confirm => {
                window.confirmationResult = confirm;
                document.getElementById('otpSection').style.display = 'block';
            });
        };

        window.verifyOTP = () => {
            window.confirmationResult.confirm(document.getElementById('otpInput').value);
        };

        window.logout = () => signOut(auth);

        // --- CORE LOGIC ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('bottomNav').style.display = 'flex';
                updateProfile(user);
                navTo('jumpPage', document.querySelector('.nav-item'));
            } else {
                document.getElementById('bottomNav').style.display = 'none';
                navTo('loginPage');
            }
        });

        window.navTo = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
                el.classList.add('active-nav');
            }
            if(id === 'leaderboardPage') loadLeaderboard();
        };

        function updateProfile(user) {
            document.getElementById('pName').innerText = user.displayName || "User";
            document.getElementById('pEmail').innerText = user.email || user.phoneNumber;
            document.getElementById('pImg').src = user.photoURL || "https://via.placeholder.com/85";
            document.getElementById('pUid').innerText = user.uid;
            onValue(ref(db, 'leaderboard/' + user.uid), s => {
                if(s.exists()) {
                    myBest = s.val().score;
                    document.getElementById('pBest').innerText = myBest.toFixed(2) + "m";
                }
            });
        }

        function loadLeaderboard() {
            const lbRef = query(ref(db, 'leaderboard'), orderByChild('score'), limitToLast(10));
            onValue(lbRef, (snapshot) => {
                const list = document.getElementById('lbList');
                list.innerHTML = "";
                let players = [];
                snapshot.forEach(c => players.push(c.val()));
                players.sort((a,b) => b.score - a.score).forEach((p, i) => {
                    list.innerHTML += `<div class="player-row">
                        <div class="rank-num">${i+1}</div>
                        <div class="p-name">${p.name || 'Anonymous'}</div>
                        <div class="p-score">${p.score.toFixed(2)}m</div>
                    </div>`;
                });
            });
        }

        // --- SENSOR LOGIC ---
        let isFreeFalling = false, startTime = 0, lastAcc = 9.8;
        document.getElementById('startBtn').onclick = function() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(s => { if(s=='granted') start(); });
            } else { start(); }
            this.innerText = "SENSORS ACTIVE"; this.disabled = true;
        };

        function start() {
            document.getElementById('statusText').innerText = "READY: THROW & CATCH";
            window.addEventListener('devicemotion', (e) => {
                let acc = e.accelerationIncludingGravity;
                if(!acc || !acc.x) return;
                let raw = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
                lastAcc = (lastAcc * 0.7) + (raw * 0.3);
                let now = performance.now();

                if(lastAcc < 2.5 && !isFreeFalling) {
                    isFreeFalling = true; startTime = now;
                    document.getElementById('statusText').innerText = "AIRBORNE";
                }
                if(isFreeFalling && lastAcc > 14.5) {
                    let d = (now - startTime)/1000;
                    if(d > 0.25 && d < 2.5) {
                        let h = 0.125 * 9.81 * (d**2);
                        document.getElementById('heightDisplay').innerText = h.toFixed(2);
                        if(h > myBest) {
                            set(ref(db, 'leaderboard/'+currentUser.uid), {
                                name: currentUser.displayName || "User",
                                score: h
                            });
                        }
                    }
                    isFreeFalling = false;
                    document.getElementById('statusText').innerText = "READY";
                }
            });
        }
    </script>
</body>
</html>

